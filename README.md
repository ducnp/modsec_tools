# modsec_tools

Simple scripts to parse logs generated by mod_security2 for Apache.

## What
After installing mod_security2, the amount of data generated in the logfiles made figuring out what was going on hard, so these scripts aim to provide some simple information with which to make decisions about rulesets to use.

## Filtering
There are many ways that the audit files may need to be filtered, and the analyse_audit script tries to provide a few of the more useful ones. 

- --filter TXT requires that TXT is present for one of the rules that matched a request
- --filter-id NNNNNN requires that one of the rules that matched a request had the ID provided.
- --filter-host HOST requires the hostname the request was made to contains HOST (from the Host header)
- --filter-response NNN requires the request provoked the response given
- --filter-rules When specified only requests that triggered mod_security2 rules will be included
- --filter-no-rule When specified only requests that did not trigger a mod_security2 rule will be included.

The last 2 filters are included for when the SecAuditEngine has a setting that includes relevant entries. This will normally capture a lot of requests that are triggered for reasons other than mod_security2 rules (simple 404's for instance). Sometimes it's useful to review these or to exclude these, hence these 2 filters. They cannot be used together!

## Examples

When the --show-requests and --exclude-headers flags are used, each request is printed as below.

```
    Unique ID           : UUUUUUUUUUUUUUUUUUUUUUUU
    Audit File          : ../modsec_audit.log.1
    URI                 : /xmlrpc.php
    Host                : XXXXXXXXXXXXXXXXXXXXXXX
    Date/Time           : 2015-07-13 01:09:08
    Remote Address      : AAA.109.CCC.211
    Response Code       : 401
    # of Rules Matched  : 2
      -  Request Containing Content, but Missing Content-Type header
         ID: 960904, Severity: NOTICE
         File: /usr/share/modsecurity-crs/activated_rules/modsecurity_crs_21_protocol_anomalies.conf
      -  Request Missing a User Agent Header
         ID: 960009, Severity: NOTICE
         File: /usr/share/modsecurity-crs/activated_rules/modsecurity_crs_21_protocol_anomalies.conf
```

If the --exclude-headers flag is omitted the request and response headers are also shown.


